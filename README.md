# **Домашнее задание к занятию «Микросервисы: подходы»**-***Вуколов Евгений***
 
Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.
 
 
## Задача 1: Обеспечить разработку
 
Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
 
Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.
 
Обоснуйте свой выбор.
 
## Задача 2: Логи
 
Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
 
Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.
 
Обоснуйте свой выбор.
 
## Задача 3: Мониторинг
 
Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
 
Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.
 
Обоснуйте свой выбор.
 
## Задача 4: Логи * (необязательная)
 
Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout.
 
Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.
 
### Результат выполнения:
 
docker compose файл, запустив который можно перейти по адресу:
http://localhost:8081
по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.
 
 
## Задача 5: Мониторинг * (необязательная)
 
Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:
 
- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.
 
Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.
 
### Результат выполнения:

docker compose файл, запустив который можно перейти по адресу:
http://localhost:8081
по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.
 
---
 
### Как оформить ДЗ?
 
Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
 

# **Решение**


## **Задача 1: Обеспечить разработку**

Для обеспечения процесса разработки в микросервисной архитектуре можно предложить следующее решение, которое включает в себя несколько программных продуктов и описывает их взаимодействие.

 Решение:

1. Облачная система:
Для облачной системы можно использовать Yandex cloud, а так же AWS или Google Cloud Platform (GCP), которые предоставляют гибкие и масштабируемые ресурсы для разработки и эксплуатации микросервисов.

2. Система контроля версий Git:
Используем GitHub или GitLab в качестве системы контроля версий. Каждый микросервис будет иметь свой репозиторий, что позволит командам работать независимо друг от друга.

3. Непрерывная интеграция и непрерывная поставка (CI/CD):
Для реализации CI/CD можно использовать Jenkins или GitLab CI/CD. Эти инструменты позволяют автоматизировать сборку, тестирование и развертывание микросервисов.

 Возможности решения:

- Запуск сборки по событию из системы контроля версий: Jenkins или GitLab CI/CD могут быть настроены на автоматический запуск сборки при обновлении кода в репозитории.

- Запуск сборки по кнопке с указанием параметров: Jenkins позволяет запускать сборку вручную с указанием необходимых параметров.

- Привязка настроек к каждой сборке: Используя файлы конфигурации (например, .gitlab-ci.yml), можно привязать настройки к каждой сборке.

- Создание шаблонов для различных конфигураций сборок: Jenkins предоставляет возможность создавать шаблоны для сборок, а GitLab CI/CD позволяет использовать шаблоны через .gitlab-ci.yml.

- Безопасное хранение секретных данных: Используем HashiCorp's Vault или AWS Secrets Manager для безопасного хранения паролей и ключей доступа. 
GitLab позволяет хранить секреты в виде переменных среды, которые можно использовать в файлах .gitlab-ci.yml. Эти секреты хранятся в защищённом виде и доступны только во время выполнения пайплайнов. 

- Несколько конфигураций для сборки из одного репозитория: Jenkins и GitLab CI/CD позволяют создавать несколько конфигураций сборки из одного репозитория.

- Кастомные шаги при сборке: Оба инструмента поддерживают кастомные шаги в процессе сборки.

- Собственные докер-образы для сборки проектов: Jenkins и GitLab CI/CD могут использовать собственные докер-образы для сборки проектов.

- Возможность развернуть агентов сборки на собственных серверах: Jenkins позволяет развертывать агентов на собственных серверах.

- Параллельный запуск нескольких сборок и тестов: Оба инструмента поддерживают параллельный запуск сборок и тестов.

Обоснование выбора:
- Выбор Jenkins или GitLab CI/CD в качестве инструмента для CI/CD обусловлен их широким распространением и гибкостью. GitHub или GitLab обеспечивают надежное управление 
версиями и интеграцию с инструментами CI/CD. Использование облачных платформ (YC, AWS или GCP) позволяет масштабировать инфраструктуру по мере необходимости.

Этот подход обеспечивает гибкость, масштабируемость и безопасность процесса разработки, что особенно важно для микросервисной архитектуры.


## **Задача 2: Логи**

Для сбора и анализа логов в микросервисной архитектуре можно предложить решение, основанное на ELK Stack (Elasticsearch, Logstash, Kibana) с использованием Fluentbit или Vector для сбора логов. 
Это решение соответствует заданным требованиям и обеспечивает эффективную обработку логов.

Решение:

1. Сбор логов:
Используем Fluentbit или Vector для сбора логов со всех хостов. Эти инструменты позволяют собирать логи из stdout контейнеров и системных процессов, обеспечивая минимальные требования к приложениям.

- Fluentbit — высокопроизводительный агент, который может собирать логи из различных источников и отправлять их в центральное хранилище.

- Vector — также поддерживает централизованную топологию, где агенты собирают логи и отправляют их на агрегатор для дальнейшей обработки.

2. Центральное хранилище логов:
Используем Elasticsearch в качестве центрального хранилища логов. Elasticsearch обеспечивает масштабируемость и эффективный поиск по логам.

3. Обработка и индексирование логов:
Используем Logstash для обработки и индексирования логов перед их сохранением в Elasticsearch. Logstash может преобразовывать и фильтровать логи, что упрощает их анализ.

4. Пользовательский интерфейс и анализ логов:
Используем Kibana для создания пользовательского интерфейса. Kibana позволяет искать, фильтровать и анализировать логи, а также предоставлять ссылки на сохраненные поиски.

Принципы взаимодействия:
1. Сбор логов: Fluentbit или Vector собирают логи со всех хостов и отправляют их в Logstash.

2. Обработка логов: Logstash обрабатывает и индексирует логи, отправляя их в Elasticsearch.

3. Хранение логов: Elasticsearch хранит логи, обеспечивая эффективный поиск и фильтрацию.

4. Анализ логов: Kibana предоставляет интерфейс для поиска, фильтрации и анализа логов, а также позволяет сохранять поиски и делиться ссылками на них.

 Обоснование выбора:

Выбор ELK Stack с Fluentbit или Vector обусловлен их широким распространением и возможностью удовлетворять всем заданным требованиям:

- Централизованный сбор логов: Fluentbit и Vector могут собирать логи со всех хостов.

- Минимальные требования к приложениям: Эти инструменты могут собирать логи из stdout.

- Гарантированная доставка логов: Используя буферизацию и повторные попытки, Fluentbit и Vector обеспечивают гарантированную доставку логов.

- Поиск и фильтрация логов: Elasticsearch и Kibana обеспечивают эффективный поиск и фильтрацию логов.

- Пользовательский интерфейс: Kibana предоставляет удобный интерфейс для разработчиков.

- Сохранение поисков: Kibana позволяет сохранять поиски и делиться ссылками на них.

- Этот подход обеспечивает масштабируемость, эффективность и удобство использования для сбора и анализа логов в микросервисной архитектуре.


## **Задача 3: Мониторинг**

Для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре можно предложить решение, основанное на Prometheus и Grafana. 
Это решение соответствует заданным требованиям и обеспечивает эффективный мониторинг.

Решение:
1. Сбор метрик:
Используем Prometheus для сбора метрик со всех хостов и сервисов. Prometheus — это система мониторинга, которая позволяет собирать метрики из различных источников, включая:

- Node Exporter для сбора метрик состояния ресурсов хостов (CPU, RAM, HDD, Network).

- cAdvisor для сбора метрик потребляемых ресурсов для каждого контейнера (CPU, RAM, HDD, Network).

- Сервис-специфичные экспортеры для сбора метрик, специфичных для каждого сервиса.

2. Хранение метрик:
Prometheus хранит собранные метрики в своей базе данных, что позволяет выполнять запросы и агрегировать информацию.

3. Пользовательский интерфейс и визуализация:
Используем Grafana для создания пользовательского интерфейса. Grafana позволяет делать запросы к Prometheus, агрегировать информацию и настраивать различные панели для отслеживания состояния системы.

 Принципы взаимодействия:
1. Сбор метрик: Prometheus собирает метрики с помощью различных экспортеров (Node Exporter, cAdvisor, сервис-специфичные экспортеры).

2. Хранение метрик: Prometheus хранит метрики в своей базе данных.

3. Визуализация: Grafana подключается к Prometheus для запроса метрик и создает интерактивные панели для отслеживания состояния системы.

 Обоснование выбора:
Выбор Prometheus и Grafana обусловлен их широким распространением и возможностью удовлетворять всем заданным требованиям:

- Сбор метрик: Prometheus может собирать метрики со всех хостов и сервисов.

- Сбор ресурсов: Node Exporter и cAdvisor позволяют собирать метрики состояния ресурсов хостов и потребляемых ресурсов для каждого сервиса.

- Сервис-специфичные метрики: Сервис-специфичные экспортеры могут собирать метрики, специфичные для каждого сервиса.

- Пользовательский интерфейс: Grafana обеспечивает удобный интерфейс для запросов и агрегации информации.

- Настройка панелей: Grafana позволяет настраивать различные панели для отслеживания состояния системы.

Этот подход обеспечивает масштабируемость, эффективность и удобство использования для мониторинга микросервисной архитектуры.
